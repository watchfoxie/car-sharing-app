# Bootstrap configuration for Identity Adapter
# This file is loaded BEFORE application.yaml to fetch secrets from Vault

spring:
  application:
    name: identity-adapter
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  cloud:
    vault:
      enabled: ${VAULT_ENABLED:false} # Enable via env var in staging/prod
      host: ${VAULT_HOST:localhost}
      port: ${VAULT_PORT:8200}
      scheme: ${VAULT_SCHEME:http} # Use https in prod
      authentication: APPROLE
      app-role:
        role-id: ${VAULT_ROLE_ID:} # Set via environment variable
        secret-id: ${VAULT_SECRET_ID:} # Set via environment variable or K8s secret
      kv:
        enabled: true
        backend: secret
        default-context: car-sharing/config/${spring.profiles.active}
        application-name: database,keycloak
      fail-fast: true # Fail startup if Vault is unreachable (prod safety)
      connection-timeout: 5000
      read-timeout: 15000

# Logging for Vault debugging (disable in prod)
logging:
  level:
    '[org.springframework.cloud.vault]': ${VAULT_LOG_LEVEL:INFO}
    '[org.springframework.vault]': ${VAULT_LOG_LEVEL:INFO}

<!-- Application Shell -->
<div class="app-container">
  <!-- Header/Navigation -->
  <mat-toolbar color="primary" class="app-header">
    <div class="toolbar-content">
      <!-- Logo/Brand -->
      <a routerLink="/cars" class="brand-link">
        <mat-icon class="brand-icon">directions_car</mat-icon>
        <span class="brand-text">Car Sharing</span>
      </a>

      <!-- Desktop Navigation -->
      <nav class="desktop-nav">
        <a mat-button routerLink="/cars" routerLinkActive="active-link">
          <mat-icon>list</mat-icon>
          Browse Cars
        </a>

        @if (isRenter()) {
          <a mat-button routerLink="/dashboard/renter" routerLinkActive="active-link">
            <mat-icon>dashboard</mat-icon>
            My Rentals
          </a>
        }

        @if (isOwner()) {
          <a mat-button routerLink="/dashboard/owner" routerLinkActive="active-link">
            <mat-icon>garage</mat-icon>
            Owner Dashboard
          </a>
        }
      </nav>

      <!-- Spacer -->
      <div class="spacer"></div>

      <!-- User Menu (Desktop) -->
      @if (isAuthenticated()) {
        <div class="user-menu">
          <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
            <mat-icon>account_circle</mat-icon>
            <span class="user-name">{{ userProfile()?.name || 'User' }}</span>
            <mat-icon>arrow_drop_down</mat-icon>
          </button>
          <mat-menu #userMenu="matMenu">
            <div class="menu-header">
              <div class="menu-user-name">{{ userProfile()?.name }}</div>
              <div class="menu-user-email">{{ userProfile()?.email }}</div>
            </div>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="logout()">
              <mat-icon>logout</mat-icon>
              <span>Sign Out</span>
            </button>
          </mat-menu>
        </div>
      } @else {
        <button mat-raised-button color="accent" (click)="login()">
          <mat-icon>login</mat-icon>
          Sign In
        </button>
      }

      <!-- Mobile Menu Button -->
      <button mat-icon-button class="mobile-menu-button" (click)="toggleMobileMenu()">
        <mat-icon>menu</mat-icon>
      </button>
    </div>
  </mat-toolbar>

  <!-- Mobile Side Navigation -->
  <mat-sidenav-container class="sidenav-container">
    <mat-sidenav 
      #mobileNav 
      mode="over" 
      [opened]="mobileMenuOpen" 
      (closed)="closeMobileMenu()"
      class="mobile-sidenav">
      <mat-nav-list>
        <!-- User Info (Mobile) -->
        @if (isAuthenticated()) {
          <div class="mobile-user-info">
            <mat-icon class="mobile-user-icon">account_circle</mat-icon>
            <div class="mobile-user-details">
              <div class="mobile-user-name">{{ userProfile()?.name }}</div>
              <div class="mobile-user-email">{{ userProfile()?.email }}</div>
            </div>
          </div>
          <mat-divider></mat-divider>
        }

        <!-- Navigation Links -->
        <a mat-list-item routerLink="/cars" (click)="closeMobileMenu()">
          <mat-icon matListItemIcon>list</mat-icon>
          <span matListItemTitle>Browse Cars</span>
        </a>

        @if (isRenter()) {
          <a mat-list-item routerLink="/dashboard/renter" (click)="closeMobileMenu()">
            <mat-icon matListItemIcon>dashboard</mat-icon>
            <span matListItemTitle>My Rentals</span>
          </a>
        }

        @if (isOwner()) {
          <a mat-list-item routerLink="/dashboard/owner" (click)="closeMobileMenu()">
            <mat-icon matListItemIcon>garage</mat-icon>
            <span matListItemTitle>Owner Dashboard</span>
          </a>
        }

        <mat-divider></mat-divider>

        <!-- Auth Actions -->
        @if (isAuthenticated()) {
          <a mat-list-item (click)="logout(); closeMobileMenu()">
            <mat-icon matListItemIcon>logout</mat-icon>
            <span matListItemTitle>Sign Out</span>
          </a>
        } @else {
          <a mat-list-item (click)="login(); closeMobileMenu()">
            <mat-icon matListItemIcon>login</mat-icon>
            <span matListItemTitle>Sign In</span>
          </a>
        }
      </mat-nav-list>
    </mat-sidenav>

    <!-- Main Content Area -->
    <mat-sidenav-content>
      <main class="main-content">
        <router-outlet />
      </main>

      <!-- Footer -->
      <footer class="app-footer">
        <div class="footer-content">
          <p>&copy; 2025 Car Sharing Platform. All rights reserved.</p>
          <p class="footer-tech">Built with Angular 20 & Angular Material</p>
        </div>
      </footer>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
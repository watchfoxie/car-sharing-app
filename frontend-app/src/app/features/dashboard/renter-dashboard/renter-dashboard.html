<section class="max-w-5xl mx-auto">
	<mat-card appearance="outlined">
		<mat-card-header>
			<mat-card-title>Your bookings</mat-card-title>
			<mat-card-subtitle>Track upcoming rides and manage reservations.</mat-card-subtitle>
		</mat-card-header>
		<mat-card-content>
			@if (loading()) {
				<div class="flex items-center gap-2 py-8">
					<mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
					<span>Loading your bookings…</span>
				</div>
			}

			@if (errorMessage()) {
				<p class="text-red-600 font-medium">{{ errorMessage() }}</p>
			}

			@if (!loading() && rentals().length > 0) {
				@for (rental of rentals(); track rental.id) {
					<article class="mb-6 p-4 border rounded-lg space-y-4">
						<header class="flex justify-between items-center">
							<h3 class="text-lg font-semibold">#{{ rental.id }} · Car {{ rental.carsId }}</h3>
							<mat-chip-set>
								<mat-chip [ngClass]="statusClass(rental.status)" color="primary" selected>
									{{ statusLabel(rental.status) }}
								</mat-chip>
							</mat-chip-set>
						</header>
						<dl class="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
							<div>
								<dt class="text-gray-600">Pickup</dt>
								<dd class="font-medium">{{ formatInstant(rental.pickupDatetime) }}</dd>
							</div>
							<div>
								<dt class="text-gray-600">Return</dt>
								<dd class="font-medium">{{ formatInstant(rental.returnDatetime) }}</dd>
							</div>
							<div>
								<dt class="text-gray-600">Pickup location</dt>
								<dd class="font-medium">{{ rental.pickupLocation || '—' }}</dd>
							</div>
							<div>
								<dt class="text-gray-600">Return location</dt>
								<dd class="font-medium">{{ rental.returnLocation || '—' }}</dd>
							</div>
							<div>
								<dt class="text-gray-600">Cost</dt>
								<dd class="font-medium">{{ formatCost(rental) }}</dd>
							</div>
						</dl>

						<footer class="flex items-center gap-4">
							<a mat-button color="primary" [routerLink]="['/cars', rental.carsId]">
								<mat-icon aria-hidden="true">open_in_new</mat-icon>
								View car
							</a>
							<span class="flex-auto"></span>
							@if (canCancel(rental)) {
								<button
									mat-stroked-button
									color="warn"
									(click)="cancel(rental)"
									[disabled]="cancellingId() === rental.id"
								>
									<mat-icon aria-hidden="true">cancel</mat-icon>
									<span>{{ cancellingId() === rental.id ? 'Cancelling…' : 'Cancel booking' }}</span>
								</button>
							}
						</footer>
						<mat-divider></mat-divider>
					</article>
				}

				<div class="flex justify-between items-center">
					<button mat-stroked-button (click)="loadPrevious()" [disabled]="!hasPrev()">
						<mat-icon aria-hidden="true">chevron_left</mat-icon>
						Previous
					</button>
					<span>Page {{ pageIndex() + 1 }} / {{ totalPages() || 1 }}</span>
					<button mat-stroked-button (click)="loadNext()" [disabled]="!hasNext()">
						Next
						<mat-icon aria-hidden="true">chevron_right</mat-icon>
					</button>
				</div>
			} @else if (!loading()) {
				<section class="flex flex-col items-center justify-center py-12 text-center">
					<mat-icon aria-hidden="true" class="text-6xl text-gray-400 mb-4">event_busy</mat-icon>
					<p class="text-gray-600">No bookings yet. Reserve your first ride from the <a routerLink="/cars" class="text-primary underline">car catalog</a>.</p>
				</section>
			}
		</mat-card-content>
	</mat-card>
</section>
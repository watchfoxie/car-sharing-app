<section class="dashboard">
	<mat-card appearance="outlined">
		<mat-card-header>
			<mat-card-title>Your bookings</mat-card-title>
			<mat-card-subtitle>Track upcoming rides and manage reservations.</mat-card-subtitle>
		</mat-card-header>
		<mat-card-content>
			<section class="loading" *ngIf="loading()">
				<mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
				<span>Loading your bookings…</span>
			</section>

			<p *ngIf="errorMessage()" class="error">{{ errorMessage() }}</p>

			<ng-container *ngIf="!loading() && rentals().length > 0; else emptyState">
				<article class="rental" *ngFor="let rental of rentals()">
					<header>
						<h3>#{{ rental.id }} · Car {{ rental.carsId }}</h3>
						<mat-chip-set>
							<mat-chip [ngClass]="statusClass(rental.status)" color="primary" selected>
								{{ statusLabel(rental.status) }}
							</mat-chip>
						</mat-chip-set>
					</header>
					<dl>
						<div>
							<dt>Pickup</dt>
							<dd>{{ formatInstant(rental.pickupDatetime) }}</dd>
						</div>
						<div>
							<dt>Return</dt>
							<dd>{{ formatInstant(rental.returnDatetime) }}</dd>
						</div>
						<div>
							<dt>Pickup location</dt>
							<dd>{{ rental.pickupLocation || '—' }}</dd>
						</div>
						<div>
							<dt>Return location</dt>
							<dd>{{ rental.returnLocation || '—' }}</dd>
						</div>
						<div>
							<dt>Cost</dt>
							<dd>{{ formatCost(rental) }}</dd>
						</div>
					</dl>

					<footer>
						<a mat-button color="primary" [routerLink]="['/cars', rental.carsId]">
							<mat-icon aria-hidden="true">open_in_new</mat-icon>
							View car
						</a>
						<span class="spacer"></span>
						<button
							mat-stroked-button
							color="warn"
							*ngIf="canCancel(rental)"
							(click)="cancel(rental)"
							[disabled]="cancellingId() === rental.id"
						>
							<mat-icon aria-hidden="true">cancel</mat-icon>
							<span>{{ cancellingId() === rental.id ? 'Cancelling…' : 'Cancel booking' }}</span>
						</button>
					</footer>
					<mat-divider></mat-divider>
				</article>

				<div class="pagination">
					<button mat-stroked-button (click)="loadPrevious()" [disabled]="!hasPrev()">
						<mat-icon aria-hidden="true">chevron_left</mat-icon>
						Previous
					</button>
					<span>Page {{ pageIndex() + 1 }} / {{ totalPages() || 1 }}</span>
					<button mat-stroked-button (click)="loadNext()" [disabled]="!hasNext()">
						Next
						<mat-icon aria-hidden="true">chevron_right</mat-icon>
					</button>
				</div>
			</ng-container>

			<ng-template #emptyState>
				<section class="empty">
					<mat-icon aria-hidden="true">event_busy</mat-icon>
					<p>No bookings yet. Reserve your first ride from the <a routerLink="/cars">car catalog</a>.</p>
				</section>
			</ng-template>
		</mat-card-content>
	</mat-card>
</section>

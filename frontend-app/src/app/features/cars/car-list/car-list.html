<section class="filters" [formGroup]="filtersForm">
	<mat-card appearance="outlined">
		<mat-card-title>Filter fleet</mat-card-title>
		<mat-card-content class="filters-grid">
			<mat-form-field appearance="outline">
				<mat-label>Brand</mat-label>
				<input matInput formControlName="brand" placeholder="Search by brand" />
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Category</mat-label>
				<mat-select formControlName="category">
					<mat-option [value]="null">Any</mat-option>
					<mat-option *ngFor="let category of categories" [value]="category">{{ category }}</mat-option>
				</mat-select>
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Min price (MDL)</mat-label>
				<input matInput type="number" min="0" formControlName="minPrice" />
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Max price (MDL)</mat-label>
				<input matInput type="number" min="0" formControlName="maxPrice" />
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Sort by</mat-label>
				<mat-select formControlName="sort">
					<mat-option *ngFor="let option of sortOptions" [value]="option.value">{{ option.label }}</mat-option>
				</mat-select>
			</mat-form-field>
		</mat-card-content>
		<mat-card-actions>
			<button type="button" mat-stroked-button color="primary" (click)="resetFilters()">Reset filters</button>
		</mat-card-actions>
	</mat-card>
</section>

<section class="results">
	<mat-progress-spinner *ngIf="loading()" mode="indeterminate"></mat-progress-spinner>

	<p *ngIf="errorMessage()" class="error-message">{{ errorMessage() }}</p>

	<ng-container *ngIf="!loading() && !errorMessage()">
		<div class="car-cards" *ngIf="cars().length; else emptyState">
			<mat-card *ngFor="let car of cars(); trackBy: trackByCarId" appearance="outlined">
				<mat-card-header>
					<mat-card-title>{{ car.brand }} {{ car.model }}</mat-card-title>
					<mat-card-subtitle>
						{{ car.category }} Â· {{ car.dailyPrice | number: '1.0-0' }} MDL / day
					</mat-card-subtitle>
				</mat-card-header>
				<mat-card-content>
					<p *ngIf="car.description; else noDescription">{{ car.description }}</p>
					<ng-template #noDescription><p class="muted">No description provided.</p></ng-template>
					<div class="badges">
						<mat-chip *ngIf="car.shareable" color="primary" selected>Available</mat-chip>
						<mat-chip *ngIf="!car.shareable" color="warn" selected>Unavailable</mat-chip>
						<mat-chip *ngIf="car.avgRating != null" color="accent" selected>
							<mat-icon>star</mat-icon>
							{{ car.avgRating | number: '1.1-1' }}
						</mat-chip>
					</div>
				</mat-card-content>
				<mat-card-actions>
					<a mat-button color="primary" [routerLink]="['/cars', car.id]">
						<mat-icon>info</mat-icon>
						Details
					</a>
					<a
						mat-button
						color="accent"
						[routerLink]="['/booking']"
						[queryParams]="{ carId: car.id, category: car.category }"
					>
						<mat-icon>event</mat-icon>
						Book now
					</a>
				</mat-card-actions>
			</mat-card>
		</div>
	</ng-container>

	<ng-template #emptyState>
		<p class="muted">No cars match your criteria yet. Adjust filters and try again.</p>
	</ng-template>
</section>

<mat-paginator
	[length]="total()"
	[pageSize]="pageSize()"
	[pageSizeOptions]="[5, 10, 20]"
	aria-label="Car list pagination"
	(page)="onPageEvent($event)"
></mat-paginator>

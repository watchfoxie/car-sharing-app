<section class="mb-6" [formGroup]="filtersForm">
	<mat-card appearance="outlined">
		<mat-card-title>Filter fleet</mat-card-title>
		<mat-card-content class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4">
			<mat-form-field appearance="outline">
				<mat-label>Brand</mat-label>
				<input matInput formControlName="brand" placeholder="Search by brand" />
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Category</mat-label>
				<mat-select formControlName="category">
					<mat-option [value]="null">Any</mat-option>
					@for (category of categories; track category) {
						<mat-option [value]="category">{{ category }}</mat-option>
					}
				</mat-select>
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Min price (MDL)</mat-label>
				<input matInput type="number" min="0" formControlName="minPrice" />
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Max price (MDL)</mat-label>
				<input matInput type="number" min="0" formControlName="maxPrice" />
			</mat-form-field>

			<mat-form-field appearance="outline">
				<mat-label>Sort by</mat-label>
				<mat-select formControlName="sort">
					@for (option of sortOptions; track option.value) {
						<mat-option [value]="option.value">{{ option.label }}</mat-option>
					}
				</mat-select>
			</mat-form-field>
		</mat-card-content>
		<mat-card-actions>
			<button type="button" mat-stroked-button color="primary" (click)="resetFilters()">Reset filters</button>
		</mat-card-actions>
	</mat-card>
</section>

<section class="mb-6">
	@if (loading()) {
		<div class="flex justify-center items-center py-8">
			<mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
		</div>
	}

	@if (errorMessage()) {
		<p class="text-red-600 font-medium p-4 bg-red-50 rounded">{{ errorMessage() }}</p>
	}

	@if (!loading() && !errorMessage()) {
		@if (cars().length) {
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
				@for (car of cars(); track car.id) {
					<mat-card appearance="outlined">
						<mat-card-header>
							<mat-card-title>{{ car.brand }} {{ car.model }}</mat-card-title>
							<mat-card-subtitle>
								{{ car.category }} Â· {{ car.dailyPrice | number: '1.0-0' }} MDL / day
							</mat-card-subtitle>
						</mat-card-header>
						<mat-card-content>
							@if (car.description) {
								<p>{{ car.description }}</p>
							} @else {
								<p class="text-gray-500">No description provided.</p>
							}
							<div class="flex gap-2 mt-4">
								@if (car.shareable) {
									<mat-chip color="primary" selected>Available</mat-chip>
								} @else {
									<mat-chip color="warn" selected>Unavailable</mat-chip>
								}
								@if (car.avgRating != null) {
									<mat-chip color="accent" selected>
										<mat-icon>star</mat-icon>
										{{ car.avgRating | number: '1.1-1' }}
									</mat-chip>
								}
							</div>
						</mat-card-content>
						<mat-card-actions>
							<a mat-button color="primary" [routerLink]="['/cars', car.id]">
								<mat-icon>info</mat-icon>
								Details
							</a>
							<a
								mat-button
								color="accent"
								[routerLink]="['/booking']"
								[queryParams]="{ carId: car.id, category: car.category }"
							>
								<mat-icon>event</mat-icon>
								Book now
							</a>
						</mat-card-actions>
					</mat-card>
				}
			</div>
		} @else {
			<p class="text-gray-500 text-center py-8">No cars match your criteria yet. Adjust filters and try again.</p>
		}
	}
</section>

<mat-paginator
	[length]="total()"
	[pageSize]="pageSize()"
	[pageSizeOptions]="[5, 10, 20]"
	aria-label="Car list pagination"
	(page)="onPageEvent($event)"
></mat-paginator>
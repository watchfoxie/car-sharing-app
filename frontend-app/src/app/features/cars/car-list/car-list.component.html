<!-- Car List Component Template -->
<div class="car-list-container">
  <!-- Page Header -->
  <div class="header">
    <h1 class="text-3xl font-bold">Available Cars</h1>
    <p class="text-gray-600">Find your perfect car for rent</p>
  </div>

  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-grid">
        <!-- Brand Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Brand</mat-label>
          <input
            matInput
            [(ngModel)]="brandFilter"
            (ngModelChange)="brandFilter.set($event)"
            placeholder="e.g., Toyota, BMW"
          />
          <mat-icon matPrefix>directions_car</mat-icon>
        </mat-form-field>

        <!-- Category Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Category</mat-label>
          <mat-select
            [(ngModel)]="categoryFilter"
            (ngModelChange)="categoryFilter.set($event)"
          >
            <mat-option value="">All Categories</mat-option>
            <mat-option *ngFor="let category of categories" [value]="category">
              {{ getCategoryLabel(category) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Price Min Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Min Price</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="priceMinFilter"
            (ngModelChange)="priceMinFilter.set($event)"
            placeholder="0"
          />
          <span matPrefix>$&nbsp;</span>
          <span matSuffix>/day</span>
        </mat-form-field>

        <!-- Price Max Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Max Price</mat-label>
          <input
            matInput
            type="number"
            [(ngModel)]="priceMaxFilter"
            (ngModelChange)="priceMaxFilter.set($event)"
            placeholder="1000"
          />
          <span matPrefix>$&nbsp;</span>
          <span matSuffix>/day</span>
        </mat-form-field>

        <!-- Location Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Location</mat-label>
          <input
            matInput
            [(ngModel)]="locationFilter"
            (ngModelChange)="locationFilter.set($event)"
            placeholder="City or area"
          />
          <mat-icon matPrefix>location_on</mat-icon>
        </mat-form-field>

        <!-- Status Filter -->
        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select
            [(ngModel)]="statusFilter"
            (ngModelChange)="statusFilter.set($event)"
          >
            <mat-option value="">All Statuses</mat-option>
            <mat-option *ngFor="let status of statuses" [value]="status">
              {{ status }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- Filter Actions -->
      <div class="filter-actions">
        <button mat-raised-button color="primary" (click)="applyFilters()">
          <mat-icon>search</mat-icon>
          Apply Filters
        </button>
        <button mat-stroked-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Clear All
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Sorting & Results Info -->
  <div class="results-toolbar">
    <div class="results-info">
      <span class="font-medium">{{ totalElements() }} cars found</span>
    </div>

    <mat-form-field appearance="outline" class="sort-field">
      <mat-label>Sort By</mat-label>
      <mat-select
        [(ngModel)]="sortOption"
        (ngModelChange)="sortOption.set($event); onSortChange()"
      >
        <mat-option *ngFor="let option of sortOptions" [value]="option.value">
          {{ option.label }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading()" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading cars...</p>
  </div>

  <!-- Car Grid -->
  <div *ngIf="!isLoading()" class="car-grid">
    <mat-card
      *ngFor="let car of cars(); trackBy: trackByCarId"
      class="car-card"
      (click)="viewCarDetails(car.id)"
      (keydown.enter)="viewCarDetails(car.id)"
      (keydown.space)="viewCarDetails(car.id)"
      tabindex="0"
    >
      <!-- Car Image -->
      <div class="car-image">
        <img
          [src]="car.thumbnailUrl || 'assets/placeholder-car.jpg'"
          [alt]="car.brand + ' ' + car.model"
          loading="lazy"
        />
        <div class="status-badge" [ngClass]="getStatusClass(car.status)">
          {{ car.status }}
        </div>
      </div>

      <mat-card-content>
        <!-- Car Title -->
        <h3 class="car-title">{{ car.brand }} {{ car.model }}</h3>
        <p class="car-year">{{ car.year }}</p>

        <!-- Car Details -->
        <div class="car-details">
          <div class="detail-row">
            <mat-icon>category</mat-icon>
            <span>{{ getCategoryLabel(car.category) }}</span>
          </div>
          <div class="detail-row">
            <mat-icon>location_on</mat-icon>
            <span>{{ car.location }}</span>
          </div>
          <div class="detail-row">
            <mat-icon>confirmation_number</mat-icon>
            <span>{{ car.licensePlate }}</span>
          </div>
        </div>

        <!-- Rating -->
        <div *ngIf="car.averageRating" class="rating">
          <mat-icon class="star-icon">star</mat-icon>
          <span class="rating-value">{{ car.averageRating.toFixed(1) }}</span>
          <span class="rating-count">({{ car.totalFeedback }} reviews)</span>
        </div>

        <!-- Price -->
        <div class="price-section">
          <span class="price">${{ car.pricePerDay }}</span>
          <span class="price-unit">/day</span>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button
          mat-raised-button
          color="primary"
          [disabled]="car.status !== CarStatus.AVAILABLE"
          (click)="viewCarDetails(car.id); $event.stopPropagation()"
        >
          <mat-icon>info</mat-icon>
          View Details
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && cars().length === 0" class="empty-state">
    <mat-icon class="empty-icon">search_off</mat-icon>
    <h2>No cars found</h2>
    <p>Try adjusting your filters to see more results</p>
    <button mat-raised-button color="primary" (click)="clearFilters()">
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <mat-paginator
    *ngIf="!isLoading() && cars().length > 0"
    [length]="totalElements()"
    [pageSize]="pageSize()"
    [pageIndex]="currentPage()"
    [pageSizeOptions]="[6, 12, 24, 48]"
    (page)="onPageChange($event)"
    showFirstLastButtons
  >
  </mat-paginator>
</div>

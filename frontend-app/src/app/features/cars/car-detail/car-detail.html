@if (loading()) {
	<div class="flex justify-center items-center py-12">
		<mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
	</div>
} @else {
	@if (errorMessage()) {
		<p class="text-red-600 font-medium p-4 bg-red-50 rounded mb-4">
			{{ errorMessage() }}
			<a routerLink="/cars" class="underline ml-2">Back to catalog</a>
		</p>
	}

	@if (car(); as car) {
		<mat-card appearance="outlined" class="mb-6">
			<mat-card-header>
				<mat-card-title>{{ car.brand }} {{ car.model }}</mat-card-title>
				<mat-card-subtitle>
					{{ car.category }} Â· {{ car.dailyPrice | number: '1.0-0' }} MDL / day
				</mat-card-subtitle>
			</mat-card-header>
			<mat-card-content>
				<p>{{ car.description || 'No description provided for this vehicle yet.' }}</p>
				<mat-divider class="my-4"></mat-divider>
				<div class="grid grid-cols-2 md:grid-cols-4 gap-4 my-4">
					<span class="flex items-center gap-2">
						<mat-icon>airline_seat_recline_normal</mat-icon> Seats: {{ car.seats ?? 'N/A' }}
					</span>
					<span class="flex items-center gap-2">
						<mat-icon>settings</mat-icon> Transmission: {{ car.transmissionType ?? 'N/A' }}
					</span>
					<span class="flex items-center gap-2">
						<mat-icon>local_gas_station</mat-icon> Fuel: {{ car.fuelType ?? 'N/A' }}
					</span>
					<span class="flex items-center gap-2">
						<mat-icon>pin</mat-icon> Registration: {{ car.registrationNumber }}
					</span>
				</div>
				<div class="flex gap-2">
					<mat-chip color="primary" selected>{{ car.shareable ? 'Available' : 'Unavailable' }}</mat-chip>
					@if (feedbackSummary()?.avgRating != null) {
						<mat-chip color="accent" selected>
							<mat-icon>star</mat-icon>
							{{ feedbackSummary()?.avgRating | number: '1.1-1' }} ({{ feedbackSummary()?.feedbackCount }} reviews)
						</mat-chip>
					}
				</div>
			</mat-card-content>
			<mat-card-actions>
				<a
					mat-flat-button
					color="primary"
					[routerLink]="['/booking']"
					[queryParams]="{ carId: car.id, category: car.category }"
				>
					<mat-icon>event</mat-icon>
					Reserve this car
				</a>
				<a mat-stroked-button routerLink="/cars">
					<mat-icon>arrow_back</mat-icon>
					Back to catalog
				</a>
			</mat-card-actions>
		</mat-card>

		<section class="mt-8">
			<h2 class="text-2xl font-bold mb-4">Feedback &amp; reviews</h2>
			@if (auth.isAuthenticated()) {
				<app-feedback-form
					[carId]="car.id"
					(feedbackCreated)="onFeedbackCreated()"
				></app-feedback-form>
			} @else {
				<p class="text-gray-500 mb-4">Sign in to share your experience with this car.</p>
			}
			<app-feedback-list [carId]="car.id"></app-feedback-list>
		</section>
	}
}